---
// @ts-expect-error
import { t, l, astroI18n } from "astro-i18n";
import PageLayout from "@/layouts/PageLayout.astro";
import Hero from "@/lib/components/Common/Hero/Hero.astro";
import Breadcrumbs from "@/lib/components/Core/Breadcrumbs.astro";
import { pagesIcons } from "@/lib/config/icons";
import Section from "@/lib/components/Core/Section.astro";
import CallToAction from "@/lib/components/Content/CallToAction.astro";

import { getCollection, getEntry } from "astro:content";
import Card from "@/lib/components/Common/Card/Card.astro";

let allBlogPosts: any[] = [];
await getCollection("blog").then((collection) => {
   allBlogPosts = collection.filter((post) => !post.data.isDraft).filter((post) => post.data.language === astroI18n.langCode);
});
const authorMiro = await getEntry("authors", "miro");
// Filter blog posts on isDraft and language

console.log(allBlogPosts);
---

<PageLayout title={t('nav.blog.title')}>

   <Hero slot="hero" subtitle={t('pages.blog.intro')}>
      {t('nav.blog.title')}
   </Hero>

   <Breadcrumbs slot="breadcrumbs" crumbs={[
      {label: t('nav.blog.title'), slug: l('blog'), icon: pagesIcons.blog},
   ]}/>

   <Section id={t('nav.blog.title')}>
      <div class="grid-1-2-3 min-h-fit">

         { allBlogPosts.length === 0 && (
            <p>{t('pages.blog.no_posts')}</p>
         )}
         {allBlogPosts.map((post, index) => (
            <Card 
               title={post.data.title}
               href={`/${post.slug}`}
               description={post.data.description}
               img={post.data.image}
            />
         ))}
         <!-- {#each posts as post}
         {:else}
            <p>{$LL.pages.blog.no_posts()}</p>
         {/each} -->
      </div>
   </Section>


   <!-- CTA -->
   <CallToAction />
   <!-- END CTA -->

</PageLayout>
